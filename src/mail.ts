import { createTransport } from "nodemailer";
import { ConfigDAO } from "./database/dao/ConfigDAO.js";

function escapeHtml(text: string) {
  return text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

const LOGO_FACINDUSTRIA_DATAURI =
  "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";

const EMAIL_TEMPLATE = `
  <!DOCTYPE html>
  <html lang="br">
    <head>
      <meta charset="UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    </head>
    <body>
      <div style="padding: 32px; background-color: #403f82">
        <img src="cid:logoindustria" style="max-width: 200px; width: 100%" />
      </div>
      {{emailBody}}
    </body>
  </html>
`;

export class Mail {
  private async create() {
    const config = await new ConfigDAO().getConfig();
    const smtpSenderAddress = config.smtpSenderAddress;

    const secure = config.smtpPort === 465;

    const transport = createTransport({
      host: config.smtpHost,
      port: config.smtpPort,
      secure: secure,
      auth: {
        user: config.smtpUsername,
        pass: config.smtpPassword,
      },
    });

    return { transport, smtpSenderAddress };
  }

  /**
   * Envia um e-mail de registro.
   * @param destinationEmail E-mail de destino.
   * @param userInfo
   */
  async sendRegisterMail(destinationEmail: string, userInfo: { name: string }) {
    const { transport, smtpSenderAddress } = await this.create();

    return transport.sendMail({
      sender: smtpSenderAddress,
      to: destinationEmail,
      subject: "Inscrição confirmada!",
      text: `Parabéns ${userInfo.name}! Sua inscrição no vestibular das Faculdades da Indústria foi confirmada!`,
      html: EMAIL_TEMPLATE.replace(
        "{{emailBody}}",
        `<h1>Inscrição confirmada</h1>
        <p>Parabéns ${escapeHtml(userInfo.name)}!</p>
        <p>Sua inscrição para o vestibular das Faculdades da Indústria foi confirmada.</p>`
      ),
      attachments: [
        {
          filename: "logoindustria.png",
          cid: "logoindustria",
          content: Buffer.from(LOGO_FACINDUSTRIA_DATAURI, "base64"),
        },
      ],
    });
  }
}
